<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoRoute - Final Test</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; }
        .container { display: flex; height: 100vh; }
        .sidebar { width: 300px; background: white; padding: 20px; overflow-y: auto; box-shadow: 2px 0 8px rgba(0,0,0,0.1); }
        #map { flex: 1; }
        h2 { color: #1a73e8; margin-bottom: 15px; }
        .test-section { margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 8px; }
        .test-btn { width: 100%; padding: 12px; margin: 5px 0; border: none; border-radius: 8px; background: #1a73e8; color: white; cursor: pointer; font-size: 14px; font-weight: 600; }
        .test-btn:hover { background: #1557b0; }
        .test-btn.success { background: #1e8e3e; }
        .test-btn.error { background: #d93025; }
        .status { padding: 10px; margin: 10px 0; border-radius: 6px; font-size: 13px; }
        .status.pass { background: #e8f5e9; color: #1e8e3e; }
        .status.fail { background: #fce8e6; color: #d93025; }
        .status.info { background: #e8f0fe; color: #1a73e8; }
        #console { max-height: 200px; overflow-y: auto; background: #f5f5f5; padding: 10px; border-radius: 4px; font-size: 11px; font-family: monospace; }
        .log { padding: 2px 0; }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <h2>üß™ EcoRoute Test Suite</h2>
            
            <div class="test-section">
                <h3>1. Library Tests</h3>
                <button class="test-btn" onclick="testLibraries()">Test Libraries</button>
                <div id="libStatus"></div>
            </div>
            
            <div class="test-section">
                <h3>2. Map Tests</h3>
                <button class="test-btn" onclick="testMap()">Initialize Map</button>
                <button class="test-btn" onclick="testMarkers()">Test New Markers</button>
                <button class="test-btn" onclick="testRoute()">Test Route</button>
                <div id="mapStatus"></div>
            </div>
            
            <div class="test-section">
                <h3>3. Script Tests</h3>
                <button class="test-btn" onclick="testScriptLoad()">Load script.js</button>
                <button class="test-btn" onclick="testMapApp()">Test MapApp Class</button>
                <div id="scriptStatus"></div>
            </div>
            
            <div class="test-section">
                <h3>4. Feature Tests</h3>
                <button class="test-btn" onclick="testNavigation()">Test Navigation</button>
                <button class="test-btn" onclick="testTraffic()">Test Traffic</button>
                <div id="featureStatus"></div>
            </div>
            
            <div class="test-section">
                <h3>Console Output</h3>
                <div id="console"></div>
            </div>
            
            <div class="test-section">
                <button class="test-btn success" onclick="window.location.href='index.html'">
                    ‚úì Open Main App
                </button>
            </div>
        </div>
        <div id="map"></div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        let map, testApp;
        
        function log(msg, type = 'info') {
            const console = document.getElementById('console');
            const div = document.createElement('div');
            div.className = 'log';
            div.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
            console.appendChild(div);
            console.scrollTop = console.scrollHeight;
            window.console.log(msg);
        }
        
        function showStatus(elementId, message, pass) {
            const el = document.getElementById(elementId);
            el.innerHTML = `<div class="status ${pass ? 'pass' : 'fail'}">${pass ? '‚úì' : '‚úó'} ${message}</div>`;
        }
        
        function testLibraries() {
            log('Testing libraries...');
            let allPass = true;
            
            if (typeof L !== 'undefined') {
                log('‚úì Leaflet loaded');
            } else {
                log('‚úó Leaflet NOT loaded', 'error');
                allPass = false;
            }
            
            if (document.querySelector('link[href*="font-awesome"]')) {
                log('‚úì Font Awesome linked');
            } else {
                log('‚úó Font Awesome NOT linked', 'error');
                allPass = false;
            }
            
            showStatus('libStatus', allPass ? 'All libraries loaded' : 'Some libraries missing', allPass);
        }
        
        function testMap() {
            try {
                log('Initializing map...');
                if (map) map.remove();
                
                map = L.map('map').setView([40.7128, -74.0060], 10);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '¬© OpenStreetMap',
                    maxZoom: 19
                }).addTo(map);
                
                log('‚úì Map initialized successfully');
                showStatus('mapStatus', 'Map working correctly', true);
            } catch (e) {
                log('‚úó Map error: ' + e.message, 'error');
                showStatus('mapStatus', 'Map failed: ' + e.message, false);
            }
        }
        
        function testMarkers() {
            try {
                log('Testing new pin markers...');
                if (!map) testMap();
                
                // Start marker (blue pin)
                const startMarker = L.marker([40.7128, -74.0060], {
                    icon: L.divIcon({
                        className: 'route-marker',
                        html: `<div style="width: 40px; height: 40px; border-radius: 50% 50% 50% 0; transform: rotate(-45deg); background: linear-gradient(135deg, #1a73e8 0%, #4285f4 100%); display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);">
                            <i class="fas fa-circle" style="transform: rotate(45deg); color: white; font-size: 18px;"></i>
                        </div>`,
                        iconSize: [40, 50],
                        iconAnchor: [20, 50]
                    })
                }).addTo(map);
                startMarker.bindPopup('üìç Start (Blue Pin)');
                
                // End marker (red pin)
                const endMarker = L.marker([40.7200, -74.0100], {
                    icon: L.divIcon({
                        className: 'route-marker',
                        html: `<div style="width: 40px; height: 40px; border-radius: 50% 50% 50% 0; transform: rotate(-45deg); background: linear-gradient(135deg, #d93025 0%, #ea4335 100%); display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);">
                            <i class="fas fa-location-dot" style="transform: rotate(45deg); color: white; font-size: 18px;"></i>
                        </div>`,
                        iconSize: [40, 50],
                        iconAnchor: [20, 50]
                    })
                }).addTo(map);
                endMarker.bindPopup('üéØ Destination (Red Pin)');
                
                log('‚úì New pin markers added');
                showStatus('mapStatus', 'New markers working!', true);
            } catch (e) {
                log('‚úó Marker error: ' + e.message, 'error');
                showStatus('mapStatus', 'Markers failed: ' + e.message, false);
            }
        }
        
        function testRoute() {
            try {
                log('Testing route...');
                if (!map) testMap();
                
                const route = L.polyline([
                    [40.7128, -74.0060],
                    [40.7200, -74.0100]
                ], {
                    color: '#3498db',
                    weight: 5,
                    opacity: 0.8
                }).addTo(map);
                
                map.fitBounds(route.getBounds());
                log('‚úì Route drawn');
                showStatus('mapStatus', 'Route working!', true);
            } catch (e) {
                log('‚úó Route error: ' + e.message, 'error');
                showStatus('mapStatus', 'Route failed: ' + e.message, false);
            }
        }
        
        function testScriptLoad() {
            log('Loading script.js...');
            const script = document.createElement('script');
            script.src = 'script.js?' + Date.now(); // Cache bust
            script.onload = () => {
                log('‚úì script.js loaded');
                showStatus('scriptStatus', 'Script loaded successfully', true);
            };
            script.onerror = () => {
                log('‚úó script.js failed to load', 'error');
                showStatus('scriptStatus', 'Script failed to load', false);
            };
            document.body.appendChild(script);
        }
        
        function testMapApp() {
            try {
                log('Testing MapApp class...');
                if (typeof MapApp === 'undefined') {
                    throw new Error('MapApp class not found. Load script.js first.');
                }
                
                log('‚úì MapApp class exists');
                log('Testing MapApp methods...');
                
                const methods = ['initMap', 'drawRoute', 'startLiveNavigation', 'fetchTrafficIncidentsAlongRoute'];
                methods.forEach(method => {
                    if (MapApp.prototype[method]) {
                        log(`‚úì ${method} exists`);
                    } else {
                        log(`‚úó ${method} missing`, 'error');
                    }
                });
                
                showStatus('scriptStatus', 'MapApp class verified', true);
            } catch (e) {
                log('‚úó MapApp error: ' + e.message, 'error');
                showStatus('scriptStatus', e.message, false);
            }
        }
        
        function testNavigation() {
            log('Navigation features:');
            log('- startLiveNavigation()');
            log('- Device orientation support');
            log('- Voice guidance');
            log('- Auto-progression');
            showStatus('featureStatus', 'Navigation code implemented', true);
        }
        
        function testTraffic() {
            log('Traffic features:');
            log('- Route-specific filtering');
            log('- 500m proximity check');
            log('- Premium markers');
            showStatus('featureStatus', 'Traffic code implemented', true);
        }
        
        // Auto-run on load
        window.addEventListener('load', () => {
            setTimeout(() => {
                log('=== Starting Auto Tests ===');
                testLibraries();
                setTimeout(() => testMap(), 500);
            }, 500);
        });
    </script>
</body>
</html>
